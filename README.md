# Notes Application - Markdown Editor

Полнофункциональное desktop-приложение для заметок на Python + PyQt6 с поддержкой Markdown.

## Архитектурные принципы

- **Markdown - единственный канонический формат хранения заметок**
- HTML не используется ни для хранения, ни как промежуточный формат
- Любое форматирование обратимо без деградации Markdown

## Возможности

### Редактор

- **Визуальное форматирование** через toolbar:
  - Bold (**)
  - Italic (*)
  - Heading (H1–H3 через #)
  - Bullet list (-)
  - Quote (>)
  - Inline code (`)

- **Два режима работы**:
  1. **Visual Markdown mode**: визуальное представление с форматированием
  2. **Raw Markdown mode**: чистый markdown-текст без визуальных элементов

- Переключение режимов **НЕ меняет** содержимое markdown-текста

### Хранение

- Локальное хранение через SQLite
- Каждая заметка содержит:
  - `id`
  - `title`
  - `markdown_content` (TEXT) - **только Markdown**
  - `created_at`
  - `updated_at`

### Настройки внешнего вида

- Выбор темы: светлая, темная, системная
- Выбор цвета кнопок из палитры
- Настройка размера шрифта (8-24pt):
  - Размер применяется ко всем элементам интерфейса
  - Заголовки автоматически на 6pt больше основного размера
  - Обычный текст использует выбранный размер

## Установка и запуск

### Требования

- Python 3.8+
- PyQt6
- Ubuntu (или другая Linux система)

### Установка зависимостей

```bash
# Создайте виртуальное окружение (рекомендуется)
python3 -m venv venv
source venv/bin/activate

# Установите зависимости
pip install -r requirements.txt
```

**Примечание**: QMarkdownTextEdit не является стандартным пакетом. Приложение использует встроенную поддержку Markdown в PyQt6 QTextEdit через методы `setMarkdown()` и `toMarkdown()`. Если требуется использовать библиотеку QMarkdownTextEdit от pbek, установите её вручную из [репозитория](https://github.com/pbek/QMarkdownTextEdit).

### Запуск

```bash
python3 main.py
```

Или используйте скрипт:

```bash
./run.sh
```

## Синхронизация с Google Keep

Приложение поддерживает синхронизацию заметок с Google Keep.

### Настройка аутентификации

Для синхронизации с Google Keep необходимо использовать **токен приложения** (App Password), а не обычный пароль.

#### Как получить токен приложения:

1. **Включите двухфакторную аутентификацию** в вашем Google аккаунте:
   - Перейдите в [Настройки безопасности Google](https://myaccount.google.com/security)
   - Включите двухфакторную аутентификацию, если она еще не включена

2. **Создайте токен приложения**:
   - Перейдите на страницу [Токены приложений](https://myaccount.google.com/apppasswords)
   - Выберите приложение: "Mail" или "Other (Custom name)"
   - Введите имя (например, "Notes App")
   - Нажмите "Создать"
   - Google покажет 16-символьный токен (например: `abcd efgh ijkl mnop`)

3. **Используйте токен в приложении**:
   - В настройках синхронизации Google Keep введите ваш email
   - В поле "Токен приложения" введите 16-символьный токен **без пробелов** (например: `abcdefghijklmnop`)
   - Нажмите "Тест соединения" для проверки

**Важно:** 
- Используйте токен приложения, а не обычный пароль
- Токен состоит из 16 символов (без пробелов)
- Если токен не работает, создайте новый

## Структура проекта

```
notes-google-keep/
├── main.py                 # Точка входа
├── gui.py                  # GUI слой (PyQt6)
├── editor.py               # Логика редактора (Visual/Raw режимы)
├── models.py               # Модели данных (Note)
├── database.py             # Database layer (SQLite)
├── sync_manager.py         # Sync layer (Safe/Extended Markdown)
├── settings.py             # Управление настройками
├── themes.py               # Темы оформления
├── settings_dialog.py      # Диалог настроек
└── requirements.txt        # Зависимости
```

## Архитектура

### Разделение слоев

- **GUI**: `gui.py` - интерфейс пользователя
- **Editor logic**: `editor.py` - логика редактора с двумя режимами
- **Database layer**: `database.py` - работа с SQLite
- **Sync layer**: `sync_manager.py` - синхронизация с поддержкой Safe/Extended Markdown

### Классы

- `Note`: модель заметки (dataclass)
- `DatabaseManager`: управление базой данных
- `MarkdownEditor`: управление редактором (Visual/Raw режимы)
- `SyncManager`: синхронизация заметок
- `MarkdownLevel`: определение Safe/Extended Markdown

## Использование

1. **Создание заметки**: Нажмите кнопку "+" или используйте Ctrl+N
2. **Редактирование**: Выберите заметку из списка и начните редактировать
3. **Форматирование**: Используйте кнопки на toolbar для применения форматирования
4. **Переключение режимов**: Нажмите кнопку "Visual"/"Raw" для переключения между визуальным и текстовым режимами
5. **Автосохранение**: Заметки сохраняются автоматически через 1 секунду после изменения
6. **Настройки**: Используйте меню "Настройки" → "Внешний вид" для изменения темы, цвета кнопок и размера шрифта

## Лицензия

MIT
